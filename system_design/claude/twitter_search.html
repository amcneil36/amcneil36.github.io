<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Design: Twitter Search</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #0f0f0f; color: #e0e0e0; line-height: 1.7; }
h1 { color: #1da1f2; border-bottom: 3px solid #1da1f2; padding-bottom: 10px; font-size: 2.2em; }
h2 { color: #4db8ff; margin-top: 40px; font-size: 1.6em; border-left: 4px solid #4db8ff; padding-left: 12px; }
h3 { color: #80cfff; font-size: 1.3em; }
.section { background: #1a1a2e; border-radius: 10px; padding: 25px; margin: 20px 0; border: 1px solid #333; }
.diagram-container { background: #0d1117; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center; overflow-x: auto; }
.example { background: #1e293b; border-left: 4px solid #f59e0b; padding: 15px 20px; margin: 15px 0; border-radius: 0 8px 8px 0; }
.example strong { color: #f59e0b; }
table { width: 100%; border-collapse: collapse; margin: 15px 0; }
th { background: #2a2a4a; color: #4db8ff; padding: 12px; text-align: left; border: 1px solid #444; }
td { padding: 10px 12px; border: 1px solid #333; }
tr:nth-child(even) { background: #1a1a2e; }
tr:nth-child(odd) { background: #151528; }
code { background: #2d2d4d; padding: 2px 8px; border-radius: 4px; color: #ff79c6; font-size: 0.95em; }
.tag { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; margin: 2px; }
.tag-pk { background: #4a1a6b; color: #d4a5ff; }
.tag-idx { background: #4a3a1a; color: #ffd4a5; }
ul { padding-left: 25px; }
li { margin: 5px 0; }
.tradeoff { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; }
.pro { background: #0a2a1a; border: 1px solid #2a5a3a; padding: 15px; border-radius: 8px; }
.con { background: #2a0a1a; border: 1px solid #5a2a3a; padding: 15px; border-radius: 8px; }
</style>
</head>
<body>
<h1>System Design: Twitter Search</h1>

<div class="section">
<h2>Functional Requirements</h2>
<ul>
<li>Full-text search across all tweets (hundreds of billions of tweets)</li>
<li>Real-time indexing ‚Äî new tweets searchable within seconds of posting</li>
<li>Search by keywords, hashtags, user mentions, cashtags ($AAPL)</li>
<li>Filter by: recency, popularity, media type, language, location</li>
<li>Trending topics and hashtag discovery</li>
<li>User search (find users by name or handle)</li>
<li>Typeahead / autocomplete suggestions</li>
</ul>
</div>

<div class="section">
<h2>Non-Functional Requirements</h2>
<ul>
<li><strong>Latency:</strong> Search results in &lt;500ms</li>
<li><strong>Freshness:</strong> New tweets indexed within 10 seconds of creation (near real-time)</li>
<li><strong>Scalability:</strong> Handle billions of queries/day, index 500M+ tweets/day</li>
<li><strong>Relevance:</strong> Results ranked by relevance + recency + engagement</li>
<li><strong>Availability:</strong> 99.99% ‚Äî search is a core feature</li>
</ul>
</div>

<!-- Flow 1: Indexing -->
<div class="section">
<h2>Flow 1: Tweet Indexing (Write Path)</h2>
<div class="diagram-container">
<svg viewBox="0 0 1050 380" xmlns="http://www.w3.org/2000/svg">
<defs><marker id="arrow1" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#1da1f2"/></marker></defs>
<rect x="20" y="150" width="130" height="60" rx="10" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="85" y="178" text-anchor="middle" fill="white" font-size="12">Tweet Service</text><text x="85" y="195" text-anchor="middle" fill="white" font-size="10">(new tweet)</text>
<rect x="200" y="150" width="130" height="60" rx="10" fill="#8338ec" stroke="#b06efd" stroke-width="2"/><text x="265" y="185" text-anchor="middle" fill="white" font-size="12">Kafka</text>
<rect x="390" y="90" width="150" height="50" rx="8" fill="#d4a017" stroke="#f0c040" stroke-width="2"/><text x="465" y="118" text-anchor="middle" fill="white" font-size="11">Tokenizer / NLP</text><text x="465" y="132" text-anchor="middle" fill="white" font-size="10">(text processing)</text>
<rect x="390" y="200" width="150" height="50" rx="8" fill="#c77dba" stroke="#e0a5d8" stroke-width="2"/><text x="465" y="228" text-anchor="middle" fill="white" font-size="11">Index Writer</text><text x="465" y="242" text-anchor="middle" fill="white" font-size="10">(inverted index)</text>
<rect x="390" y="300" width="150" height="50" rx="8" fill="#e76f51" stroke="#ff9a76" stroke-width="2"/><text x="465" y="330" text-anchor="middle" fill="white" font-size="11">Entity Extractor</text><text x="465" y="344" text-anchor="middle" fill="white" font-size="10">(hashtags, mentions)</text>
<rect x="620" y="90" width="150" height="50" rx="8" fill="#1e6091" stroke="#3a8cbf" stroke-width="2"/><text x="695" y="115" text-anchor="middle" fill="white" font-size="11">Real-time Index</text><text x="695" y="130" text-anchor="middle" fill="white" font-size="10">(Earlybird/Lucene)</text>
<ellipse cx="695" cy="225" rx="70" ry="28" fill="#6b2fa0" stroke="#9d5fd0" stroke-width="2"/><text x="695" y="222" text-anchor="middle" fill="white" font-size="10">Full Index</text><text x="695" y="238" text-anchor="middle" fill="white" font-size="10">(Historical)</text>
<rect x="850" y="140" width="130" height="50" rx="8" fill="#c0392b" stroke="#e74c3c" stroke-width="2"/><text x="915" y="170" text-anchor="middle" fill="white" font-size="12">Trending Svc</text>
<line x1="150" y1="180" x2="198" y2="180" stroke="#1da1f2" stroke-width="2" marker-end="url(#arrow1)"/>
<line x1="330" y1="168" x2="388" y2="118" stroke="#1da1f2" stroke-width="2" marker-end="url(#arrow1)"/>
<line x1="330" y1="190" x2="388" y2="225" stroke="#1da1f2" stroke-width="2" marker-end="url(#arrow1)"/>
<line x1="330" y1="195" x2="388" y2="325" stroke="#1da1f2" stroke-width="1.5" marker-end="url(#arrow1)"/>
<line x1="540" y1="115" x2="618" y2="115" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow1)"/>
<line x1="540" y1="230" x2="623" y2="228" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow1)"/>
<line x1="540" y1="325" x2="848" y2="170" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow1)"/>
<text x="520" y="30" text-anchor="middle" fill="#aaa" font-size="16" font-weight="bold">Twitter Search: Indexing Pipeline</text>
</svg>
</div>

<h3>Step-by-Step</h3>
<ol>
<li><strong>Tweet published</strong> ‚Üí event sent to Kafka "tweets" topic</li>
<li><strong>Tokenizer / NLP:</strong> Processes tweet text ‚Äî tokenization, stemming, language detection, stop word removal. "I'm running fast" ‚Üí tokens: ["run", "fast"]</li>
<li><strong>Entity Extractor:</strong> Identifies hashtags (#tech), mentions (@elonmusk), cashtags ($AAPL), URLs, emojis. Creates structured entities</li>
<li><strong>Index Writer:</strong> Builds inverted index entries: token ‚Üí [tweet_id_1, tweet_id_2, ...]. Writes to both Real-time Index (in-memory, last 7 days) and Full Index (on-disk, all time)</li>
<li><strong>Trending Service:</strong> Counts hashtag/topic frequency using Count-Min Sketch. Detects spikes against baseline</li>
</ol>

<div class="example">
<strong>Example:</strong> Tweet: "Just bought $AAPL after the earnings call! üöÄ #investing #stocks" ‚Üí Tokenizer produces: ["bought", "aapl", "earnings", "call", "investing", "stocks"]. Entity Extractor: hashtags=[#investing, #stocks], cashtags=[$AAPL]. Index Writer creates entries: "aapl" ‚Üí [tweet_12345], "investing" ‚Üí [tweet_12345], etc. Written to Earlybird real-time index within 5 seconds. Searchable immediately.
</div>

<h3>Deep Dive: Earlybird (Real-time Index)</h3>
<ul>
<li><strong>What:</strong> Twitter's custom real-time search engine (based on Lucene). Holds tweets from last 7 days in memory</li>
<li><strong>Architecture:</strong> Tweets hash-partitioned across ~200 Earlybird servers. Each server holds a shard of the index</li>
<li><strong>Inverted index in memory:</strong> Token ‚Üí posting list (sorted tweet_ids with positions). ~50GB RAM per server</li>
<li><strong>Updates:</strong> New tweets indexed within seconds. Index segments merged periodically (like Lucene merge policy)</li>
<li><strong>Why custom:</strong> Standard Elasticsearch not fast enough for Twitter's real-time indexing latency requirements (~5 second freshness)</li>
</ul>
</div>

<!-- Flow 2: Search Query -->
<div class="section">
<h2>Flow 2: Search Query Execution (Read Path)</h2>
<div class="diagram-container">
<svg viewBox="0 0 1100 400" xmlns="http://www.w3.org/2000/svg">
<defs><marker id="arrow2" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#ffaa00"/></marker></defs>
<rect x="20" y="160" width="110" height="60" rx="10" fill="#2a9d8f" stroke="#4ad4c0" stroke-width="2"/><text x="75" y="195" text-anchor="middle" fill="white" font-size="13">User</text>
<rect x="170" y="160" width="130" height="60" rx="10" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="235" y="195" text-anchor="middle" fill="white" font-size="12">Search Service</text>
<rect x="350" y="80" width="140" height="50" rx="8" fill="#1e6091" stroke="#3a8cbf" stroke-width="2"/><text x="420" y="108" text-anchor="middle" fill="white" font-size="11">Earlybird (Real-time)</text><text x="420" y="122" text-anchor="middle" fill="white" font-size="10">Last 7 days</text>
<rect x="350" y="180" width="140" height="50" rx="8" fill="#6b2fa0" stroke="#9d5fd0" stroke-width="2"/><text x="420" y="208" text-anchor="middle" fill="white" font-size="11">Full Index</text><text x="420" y="222" text-anchor="middle" fill="white" font-size="10">Historical</text>
<rect x="350" y="280" width="140" height="50" rx="8" fill="#d4a017" stroke="#f0c040" stroke-width="2"/><text x="420" y="308" text-anchor="middle" fill="white" font-size="11">Blender</text><text x="420" y="322" text-anchor="middle" fill="white" font-size="10">(Result Merger)</text>
<rect x="560" y="160" width="140" height="60" rx="8" fill="#c77dba" stroke="#e0a5d8" stroke-width="2"/><text x="630" y="188" text-anchor="middle" fill="white" font-size="12">Ranking Service</text><text x="630" y="205" text-anchor="middle" fill="white" font-size="10">(ML Scorer)</text>
<rect x="770" y="80" width="130" height="50" rx="8" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="835" y="108" text-anchor="middle" fill="white" font-size="11">Tweet Hydrator</text>
<rect x="770" y="200" width="130" height="50" rx="8" fill="#e76f51" stroke="#ff9a76" stroke-width="2"/><text x="835" y="228" text-anchor="middle" fill="white" font-size="11">Safety Filter</text>
<rect x="960" y="160" width="110" height="50" rx="10" fill="#2a9d8f" stroke="#4ad4c0" stroke-width="2"/><text x="1015" y="190" text-anchor="middle" fill="white" font-size="12">Results</text>
<line x1="130" y1="190" x2="168" y2="190" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="300" y1="178" x2="348" y2="110" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="300" y1="195" x2="348" y2="205" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="490" y1="110" x2="490" y2="278" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow2)"/>
<line x1="490" y1="215" x2="490" y2="278" stroke="#ffaa00" stroke-width="1.5"/>
<line x1="490" y1="305" x2="558" y2="195" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="700" y1="180" x2="768" y2="110" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="700" y1="200" x2="768" y2="225" stroke="#ffaa00" stroke-width="2" marker-end="url(#arrow2)"/>
<line x1="900" y1="105" x2="958" y2="175" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow2)"/>
<text x="550" y="25" text-anchor="middle" fill="#aaa" font-size="16" font-weight="bold">Twitter Search: Query Execution</text>
</svg>
</div>

<h3>Step-by-Step</h3>
<ol>
<li><strong>User searches "earthquake california"</strong> ‚Üí <code>GET /v1/search?q=earthquake+california&result_type=recent</code></li>
<li><strong>Search Service:</strong> Parses query, identifies tokens ["earthquake", "california"], detects filter mode (recent/top/media)</li>
<li><strong>Scatter-gather:</strong> Query sent to all Earlybird shards (real-time, last 7 days) AND full index shards (historical). Each shard returns top-K local results</li>
<li><strong>Blender:</strong> Merges results from all shards. Deduplicates. Selects top 500 candidates</li>
<li><strong>Ranking Service (ML):</strong> Scores each tweet: <code>score = text_relevance * 0.3 + engagement * 0.25 + recency * 0.25 + author_authority * 0.2</code></li>
<li><strong>Tweet Hydrator:</strong> Fetches full tweet objects (text, author info, media, engagement counts)</li>
<li><strong>Safety Filter:</strong> Removes NSFW, spam, blocked users, muted keywords from results</li>
<li><strong>Returns top 20 results</strong> per page</li>
</ol>

<div class="example">
<strong>Example:</strong> User searches "earthquake california". Earlybird real-time shards find 2000 recent tweets containing both tokens. Full index finds 50K historical matches. Blender merges and selects top 500 by initial score. ML Ranking: breaking news tweet from @USGS (verified, 10K retweets, 2 min old) scores 0.98. Old news article from 2019 scores 0.15. Top 20 returned. Total latency: ~350ms (scatter: 100ms, rank: 50ms, hydrate: 100ms, network: 100ms).
</div>

<h3>Deep Dive: Inverted Index</h3>
<ul>
<li><strong>Structure:</strong> Dictionary (token ‚Üí posting list). Posting list = sorted array of (tweet_id, position, metadata)</li>
<li><strong>Boolean query:</strong> "earthquake AND california" ‚Üí intersect posting lists for "earthquake" and "california". Use skip pointers for efficient intersection</li>
<li><strong>Phrase query:</strong> "earthquake in california" ‚Üí check position offsets (earthquake at pos 0, in at pos 1, california at pos 2 in same tweet)</li>
<li><strong>Compression:</strong> Delta encoding + variable-byte encoding for posting lists. 4x compression ratio</li>
</ul>
</div>

<!-- Combined Architecture -->
<div class="section">
<h2>Combined Overall Architecture</h2>
<div class="diagram-container">
<svg viewBox="0 0 1100 500" xmlns="http://www.w3.org/2000/svg">
<defs><marker id="arrow3" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#1da1f2"/></marker></defs>
<text x="550" y="25" text-anchor="middle" fill="#aaa" font-size="16" font-weight="bold">Twitter Search: Combined Architecture</text>
<rect x="20" y="200" width="100" height="50" rx="8" fill="#2a9d8f" stroke="#4ad4c0" stroke-width="2"/><text x="70" y="230" text-anchor="middle" fill="white" font-size="12">Clients</text>
<rect x="160" y="200" width="110" height="50" rx="8" fill="#e76f51" stroke="#ff9a76" stroke-width="2"/><text x="215" y="230" text-anchor="middle" fill="white" font-size="12">API Gateway</text>
<rect x="320" y="100" width="120" height="40" rx="8" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="380" y="125" text-anchor="middle" fill="white" font-size="11">Search Svc</text>
<rect x="320" y="180" width="120" height="40" rx="8" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="380" y="205" text-anchor="middle" fill="white" font-size="11">Typeahead Svc</text>
<rect x="320" y="260" width="120" height="40" rx="8" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="380" y="285" text-anchor="middle" fill="white" font-size="11">Trending Svc</text>
<rect x="320" y="340" width="120" height="40" rx="8" fill="#8338ec" stroke="#b06efd" stroke-width="2"/><text x="380" y="365" text-anchor="middle" fill="white" font-size="11">Kafka</text>
<rect x="520" y="60" width="130" height="40" rx="8" fill="#1e6091" stroke="#3a8cbf" stroke-width="2"/><text x="585" y="85" text-anchor="middle" fill="white" font-size="10">Earlybird (RT)</text>
<rect x="520" y="120" width="130" height="40" rx="8" fill="#6b2fa0" stroke="#9d5fd0" stroke-width="2"/><text x="585" y="145" text-anchor="middle" fill="white" font-size="10">Full Index (Hist)</text>
<rect x="520" y="180" width="130" height="40" rx="8" fill="#d4a017" stroke="#f0c040" stroke-width="2"/><text x="585" y="205" text-anchor="middle" fill="white" font-size="10">Blender</text>
<rect x="520" y="240" width="130" height="40" rx="8" fill="#c77dba" stroke="#e0a5d8" stroke-width="2"/><text x="585" y="265" text-anchor="middle" fill="white" font-size="10">ML Ranker</text>
<rect x="520" y="300" width="130" height="40" rx="8" fill="#e76f51" stroke="#ff9a76" stroke-width="2"/><text x="585" y="325" text-anchor="middle" fill="white" font-size="10">Safety Filter</text>
<rect x="520" y="360" width="130" height="40" rx="8" fill="#d4a017" stroke="#f0c040" stroke-width="2"/><text x="585" y="385" text-anchor="middle" fill="white" font-size="10">Index Writer</text>
<rect x="730" y="180" width="110" height="40" rx="8" fill="#457b9d" stroke="#6db5d9" stroke-width="2"/><text x="785" y="205" text-anchor="middle" fill="white" font-size="10">Hydrator</text>
<rect x="730" y="260" width="110" height="40" rx="8" fill="#c0392b" stroke="#e74c3c" stroke-width="2"/><text x="785" y="285" text-anchor="middle" fill="white" font-size="10">Result Cache</text>
<line x1="120" y1="225" x2="158" y2="225" stroke="#1da1f2" stroke-width="2" marker-end="url(#arrow3)"/>
<line x1="270" y1="218" x2="318" y2="120" stroke="#1da1f2" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="270" y1="225" x2="318" y2="200" stroke="#1da1f2" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="270" y1="232" x2="318" y2="280" stroke="#1da1f2" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="440" y1="120" x2="518" y2="80" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow3)"/>
<line x1="440" y1="120" x2="518" y2="140" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow3)"/>
<line x1="585" y1="100" x2="585" y2="178" stroke="#ffaa00" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="585" y1="160" x2="585" y2="178" stroke="#ffaa00" stroke-width="1"/>
<line x1="585" y1="220" x2="585" y2="238" stroke="#ffaa00" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="585" y1="280" x2="585" y2="298" stroke="#ffaa00" stroke-width="1" marker-end="url(#arrow3)"/>
<line x1="650" y1="200" x2="728" y2="200" stroke="#ffaa00" stroke-width="1.5" marker-end="url(#arrow3)"/>
<line x1="440" y1="360" x2="518" y2="380" stroke="#66ff66" stroke-width="1.5" marker-end="url(#arrow3)"/>
<line x1="650" y1="380" x2="650" y2="80" stroke="#66ff66" stroke-width="1" stroke-dasharray="4,4" marker-end="url(#arrow3)"/>
</svg>
</div>
</div>

<!-- Database Schema -->
<div class="section">
<h2>Database Schema</h2>

<h3>Inverted Index (Earlybird / Custom Lucene)</h3>
<table>
<tr><th>Structure</th><th>Key</th><th>Value</th><th>Storage</th></tr>
<tr><td>Token Dictionary</td><td>token (string)</td><td>Pointer to posting list</td><td>In-memory hash map</td></tr>
<tr><td>Posting List</td><td>token</td><td>Sorted [tweet_id, position, field, flags]</td><td>In-memory compressed arrays</td></tr>
<tr><td>Tweet Forward Index</td><td>tweet_id</td><td>{author_id, timestamp, engagement_score, lang}</td><td>In-memory columnar</td></tr>
</table>

<h3>Trending Data ‚Äî Redis</h3>
<table>
<tr><th>Key</th><th>Type</th><th>Details</th></tr>
<tr><td><code>trending:{region}:{timewindow}</code></td><td>Sorted Set</td><td>Members: hashtag/topic, Score: count in window</td></tr>
<tr><td><code>trending:global:current</code></td><td>Sorted Set</td><td>Top 50 global trending topics</td></tr>
</table>

<h4>Sharding Strategy</h4>
<ul>
<li><strong>Earlybird:</strong> Tweets hash-partitioned by tweet_id across ~200 shards. Search query sent to ALL shards (scatter-gather)</li>
<li><strong>Full Index:</strong> Time-based sharding. Each shard holds 1 week of data. Recent shards queried first. Old shards only queried if user requests historical results</li>
<li><strong>Trending:</strong> Redis per-region sharding. Global trending computed from regional aggregates</li>
</ul>
</div>

<div class="section">
<h2>Cache Deep Dive</h2>
<table>
<tr><th>Cache</th><th>Strategy</th><th>Eviction</th><th>TTL</th></tr>
<tr><td>Search Result Cache</td><td>Read-through</td><td>LRU</td><td>30 seconds (very short ‚Äî results change rapidly)</td></tr>
<tr><td>Typeahead Cache</td><td>Write-through</td><td>LRU</td><td>5 minutes</td></tr>
<tr><td>Tweet Cache (Memcached)</td><td>Read-through</td><td>LRU</td><td>1 hour</td></tr>
<tr><td>Trending Cache</td><td>Write-through</td><td>TTL</td><td>1 minute</td></tr>
</table>
<p><strong>CDN:</strong> Search results NOT cached at CDN (dynamic, personalized). Only media (images, videos) in search results served via CDN.</p>
</div>

<div class="section">
<h2>Scaling Considerations</h2>
<ul>
<li><strong>Scatter-gather:</strong> Query goes to 200+ Earlybird shards. Each shard processes independently, returns top-K local results. Blender merges. Latency = max(shard latencies). Mitigated by: hedged requests (send to 2 replicas, take first response), timeout and skip slow shards</li>
<li><strong>Real-time indexing scale:</strong> 500M tweets/day = ~6K tweets/sec. Each Earlybird shard indexes ~30 tweets/sec. Index stays in memory for speed</li>
<li><strong>Historical index:</strong> Petabytes of historical data on SSDs. Only queried on-demand (when user scrolls past recent results)</li>
<li><strong>Surge handling:</strong> Major events (Super Bowl, elections) cause 10x search spikes. Pre-scale based on event calendar. Auto-scale Earlybird replicas</li>
</ul>
</div>

<div class="section">
<h2>Tradeoffs & Deep Dives</h2>
<div class="tradeoff">
<div class="pro"><h4>‚úÖ Custom Search (Earlybird)</h4><ul><li>Optimized for Twitter's specific access patterns</li><li>~5 second indexing latency (Elasticsearch: 1-30 seconds)</li><li>In-memory for recent tweets = ultra-fast queries</li></ul></div>
<div class="con"><h4>‚ùå Custom Search Downsides</h4><ul><li>Massive engineering investment to build and maintain</li><li>No community support (vs Elasticsearch ecosystem)</li><li>Specialized knowledge required</li></ul></div>
</div>
</div>

<div class="section">
<h2>Alternative Approaches</h2>
<ul>
<li><strong>Elasticsearch:</strong> Off-the-shelf full-text search. Easier to operate. Good enough for most scale. Tradeoff: 1-30s indexing latency, higher resource usage</li>
<li><strong>Apache Solr:</strong> Another Lucene-based option. Strong for faceted search. Less real-time oriented than Earlybird</li>
<li><strong>Embedding-based search:</strong> Use neural embeddings (BERT) for semantic search. "earthquake damage" matches "seismic destruction" even without exact keyword match. Higher latency, requires ANN index (FAISS/HNSW)</li>
</ul>
</div>

<div class="section">
<h2>Additional Information</h2>
<ul>
<li><strong>Query understanding:</strong> NLP pipeline parses queries: spell correction ("eathquake" ‚Üí "earthquake"), synonym expansion ("car" ‚Üí "car OR automobile"), intent detection (is user searching for news, people, or media?)</li>
<li><strong>Personalization:</strong> Same query, different results per user. If user frequently engages with sports content, sports-related results boosted</li>
<li><strong>Safe search:</strong> Sensitive content filtered by default. NSFW classifier runs on indexed tweets. Users can opt-in to see all results</li>
<li><strong>Search ads:</strong> Promoted tweets inserted into search results. Ad auction runs in parallel with organic search. Relevance threshold: ad must be relevant to query to be shown</li>
</ul>
</div>
</body>
</html>
